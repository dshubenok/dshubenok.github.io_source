Ушли времена, когда веб-проекты были монолитными и в качестве клиента использовались только браузеры на десктопных компьютерах. В современном мире бэкенд работает как независимая часть, задача которой — предоставлять данные для веб-клиентов, мобильных приложений, ботов, других сервисов. Нужно уметь создавать современный бэкенд, который возвращает данные клиенту по запросу.

# Learning outcomes

Студент установит необходимые пакеты и напишет самой простой API в своей жизни в несколько строк кода, затем запустит его и получит данные в формате JSON. Всю остальную часть курса мы лишь будем непрерывно "усложнять" это API: делить на модули, добавлять CRUD-операции с БД, валидацию и так далее. Рассмотрим принципы построения правильной архитектуры. 

REST API — это всего лишь набор правил и ограничений для передачи данных. Для того, чтобы создать API, нужно просто стандартизировать выдачу данных, это можно сделать с помощью любого веб-фреймворка. Но для облегчения этой задачи существуют специальные фреймворки. Один из них — FastAPI.

В этом уроке вы установите FastAPI и напишете минимальное количество кода, необходимое для запуска приложения. Приложение вернет "Hello, world!" в формате JSON при запросе к корневому URL.

### Создание рабочего окружения.

Откройте терминал. Создайте директорию `Project`, перейдите в неё и активируйте виртуальное окружение:

    mkdir Project
    cd Project
    python3 -m venv venv
    source venv/bin/activate

Установите FastAPI с помощью пакетного менеджера pip:

    pip install fastapi

### Написание минимального кода.

Создайте в вашем любимом редакторе кода файл [main.py](http://main.py/).

Из библиотеки `fastapi` проимпортируйте класс `FastAPI`. Создайте экземпляр этого класса и присвойте его переменной `app`. Теперь `app` будет отправной точкой взаимодействия с вашим приложением.

Напишите функцию, которая возвращает приветственное сообщение, она должна возвращать словарь с ключом "message" и значением "Hello, World!".

Укажите URL, по которому будет доступно это сообщение, для этого вызовите метод `get` у экземпляра вашего приложения и передайте ему в качестве аргумента путь "/", то есть корневой путь и задекорируйте этим вызовом вашу функцию:

    from fastapi import FastAPI
    
    app = FastAPI()
    
    @app.get('/')
    def hello():
        return {"message": "Hello, world!"}

Готово! Теперь осталось запустить приложение на локальном сервере и запросить ваши данные — приветственное сообщение.

### Запуск приложения.

FastAPI не имеет встроенного веб-сервера, поэтому установим веб-сервер Uvicorn:

    pip install uvicorn
    

Для запуска приложения вам нужно перейти в директорию с ним и передать серверу имя файла и название приложения:

    uvicorn main:app --reload

Флаг `—reload` означает, что приложение будет перезапускаться при любом изменении кода. Это нужно для разработки.

Теперь выполните GET-запрос к приложению.

Для запросов удобно пользоваться графической утилитой Postman ([https://www.postman.com/downloads/](https://www.postman.com/downloads/)) или консольной HTTPie:

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9304ddc1-7491-4d3a-bbcd-5a384f4c0062/__2020-04-04__20.23.59.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9304ddc1-7491-4d3a-bbcd-5a384f4c0062/__2020-04-04__20.23.59.png)

**добавить интерактивную хуйню**

FastAPI автоматически генерирует документацию, [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs#/)/

### ТУП:

Чем проще проектируемое вами API, тем проще структура проекта. В данном случае API делает одну простую вещь — возвращает приветствие по запросу к корневому URL, поэтому и проект состоит из одного файла в несколько строк кода.

В следующих уроках вы начнете создавать настоящее API с реальными данными.

Если вы работали с другими фреймворками, например с Django, то наверняка использовали механизм скаффолдинга — вводили команды и фреймворк сам создавал структуру проекта. FastAPI придерживается другого подхода и предоставляет вам свободу в создании архитектуры проекта.

В этом уроке вы начнете создавать структуру проекта и делить проект на модули.

Немного новой терминологии. REST-архитектура API подразумевает под собой простые правила: *добавлю эти принципы* 

Полный URL-адрес, на который отправляется запрос, называется **эндпоинтом** (англ. "endpoint" - конечная точка), он состоит из хоста, версии API и идентификатора **ресурса**: [http://example.ru/v1/reviews/](http://example.ru/v1/reviews/)

**Ресурсом** называются любые данные, которые приходят в ответ на запрос. В примере выше ресурсом являются отзывы (/reviews).

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9f84e425-f733-4ac8-a0bd-a2559fbaff94/2019-09-23_14.34.56.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9f84e425-f733-4ac8-a0bd-a2559fbaff94/2019-09-23_14.34.56.jpg)

*иллюстрация*

Ещё примеры ресурсов:

- Все пользователи системы.
- Один конкретный пользователь системы.
- Список статей новостного сайта.

Каждый ресурс должен иметь единственный эндпоинт, идентифицирующий его. Общаться с эндпоинтом нужно HTTP-глаголами: GET (получить), POST (отправить), PUT (поместить) и DELETE (удалить).

Версионирование. Все изменения в API должны фиксироваться новой версией. Это нужно, чтобы клиент не переставал получать данные. Например, вы изменили имя эндпоинта или формат данных, а клиент об этом не знает и продолжает использовать старый формат.

Из курса по Django вы уже знаете, что отдельные сущности нужно делить на приложения (Apps), здесь используется похожая концепция: мы создаем так называемой **роутер** для каждой сущности.

Создайте директорию `routers` со следующей структурой:

    .
    ├── app
    │   ├── __init__.py
    │   ├── main.py
    │   └── routers
    │       ├── __init__.py
    │       ├── reviews.py
    │       ├── books.py
    │       └── authors.py
    

Откройте файл `routers/reviews` и создайте заглушки для функций, в следующих уроках мы опишем эти функции, чтобы они возвращали данные:

    from fastapi import APIRouter
    
    
    router = APIRouter()
    
    @router.post("/reviews/")
    def create_review():
        pass
    
    @router.get("/reviews/")
    def read_reviews():
        pass
    
    @router.put("/reviews/")
    def update_review():
        pass
    
    @router.delete("/reviews/")
    def delete_review():
        pass
    

- Задание 1

    Создайте роутеры и опишите функции-заглушки для сущностей books и authors.

### ТУП

Вы создали каркас для приложения, но он пока не возвращает никаких данных. В следующем уроке вы начнете добавлять в проект реальные данные.